@page
@model BlueCraeftBowl.Pages.LeaderboardModel
@{
    ViewData["Title"] = "Leaderboard";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center">
        <h2>Leaderboard</h2>
        <span class="badge bg-info" id="statusBadge">Live Updates Active</span>
    </div>
    <hr />

    <div id="leaderboardContainer">
        <table class="table table-hover shadow-sm mt-3">
            <thead class="table-dark">
                <tr>
                    <th>Rank</th>
                    <th>Participant</th>
                    <th class="text-end">Total Points</th>
                </tr>
            </thead>
            <tbody id="leaderboardBody">
                @for (int i = 0; i < Model.Leaderboard.Count; i++)
                {
                    var entry = Model.Leaderboard[i];
                    <tr>
                        <td>@(i + 1)</td>
                        <td>@entry.FullName</td>
                        <td class="text-end fw-bold">@entry.TotalPoints</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/leaderboardHub")
            .build();

        connection.on("ReceiveLeaderboardUpdate", function () {
            // Refresh the page or fetch data via AJAX to update the leaderboard
            location.reload(); 
        });

        connection.start().catch(err => console.error(err.toString()));
    </script>
}
