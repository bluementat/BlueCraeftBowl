@page
@model BlueCraeftBowl.Pages.Parlays.IndexModel
@{
    ViewData["Title"] = "My Selections";
}

<div class="container mt-4">
    <h2>Make Your Selections</h2>
    <p class="text-muted">Choose carefully! Once the game starts, selections will be locked.</p>

    @if (Model.Session?.IsLocked == true)
    {
        <div class="alert alert-warning">Selections are currently locked for this game.</div>
    }

    <form method="post">
        @for (int i = 0; i < Model.Items.Count; i++)
        {
            var item = Model.Items[i];
            var userSelection = Model.UserSelections.FirstOrDefault(s => s.ParlayItemId == item.Id);
            
            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">@item.Question</h5>
                    <input type="hidden" name="Selections[@i].ParlayItemId" value="@item.Id" />
                    
                    <div class="mt-3">
                        @if (item.Type == BlueCraeftBowl.Models.ParlayType.AB)
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="Selections[@i].SelectedValue" value="@item.OptionA" 
                                       id="radioA_@item.Id" @(userSelection?.SelectedValue == item.OptionA ? "checked" : "") 
                                       @(Model.Session?.IsLocked == true ? "disabled" : "") required>
                                <label class="form-check-label" for="radioA_@item.Id">@item.OptionA</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="Selections[@i].SelectedValue" value="@item.OptionB" 
                                       id="radioB_@item.Id" @(userSelection?.SelectedValue == item.OptionB ? "checked" : "") 
                                       @(Model.Session?.IsLocked == true ? "disabled" : "") required>
                                <label class="form-check-label" for="radioB_@item.Id">@item.OptionB</label>
                            </div>
                        }
                        else
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="Selections[@i].SelectedValue" value="Over" 
                                       id="radioO_@item.Id" @(userSelection?.SelectedValue == "Over" ? "checked" : "") 
                                       @(Model.Session?.IsLocked == true ? "disabled" : "") required>
                                <label class="form-check-label" for="radioO_@item.Id">Over (@item.Threshold)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="Selections[@i].SelectedValue" value="Under" 
                                       id="radioU_@item.Id" @(userSelection?.SelectedValue == "Under" ? "checked" : "") 
                                       @(Model.Session?.IsLocked == true ? "disabled" : "") required>
                                <label class="form-check-label" for="radioU_@item.Id">Under (@item.Threshold)</label>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }

        @if (Model.Session?.IsLocked != true && Model.Items.Any())
        {
            <button type="submit" class="btn btn-lg btn-primary w-100 mb-5">Save All Selections</button>
        }
    </form>
</div>
